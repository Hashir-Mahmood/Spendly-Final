<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp1234.Dashboard"
             BackgroundColor="#f4f6f9"
             xmlns:gauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:local="clr-namespace:MauiApp1234"
             NavigationPage.HasNavigationBar="False"
             Shell.NavBarIsVisible="False">
    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <ScrollView Grid.Row="2">
            <StackLayout Padding="20" Spacing="20">

                <Grid Grid.Row="0" Margin="20,10" ColumnDefinitions="Auto,*,Auto,Auto">
                    <Frame Grid.Column="0" CornerRadius="24" Padding="10" HasShadow="False" BackgroundColor="White" HorizontalOptions="CenterAndExpand">
                        <Image Source="ai.png" HeightRequest="20" WidthRequest="20" x:Name="ChatbotIcon"/>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="ChatbotIcon_Tapped"/>
                        </Frame.GestureRecognizers>
                    </Frame>

                    <Grid Grid.Column="1" />

                    <Frame Grid.Column="2" CornerRadius="24" Padding="10" HasShadow="False" BackgroundColor="White" >
                        <Image Source="bell.png" HeightRequest="20" WidthRequest="20" x:Name="NotificationsIcon"/>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnNotificationsIconTapped"/>
                        </Frame.GestureRecognizers>
                    </Frame>

                    <Frame Grid.Column="3" CornerRadius="20" Padding="10" HasShadow="False" BackgroundColor="White" Margin="10,0,0,0">
                        <Image Source="settings.png" HeightRequest="20" WidthRequest="20" x:Name="SettingsIcon"/>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="SettingsIcon_Tapped"/>
                        </Frame.GestureRecognizers>
                    </Frame>
                </Grid>

                <Label Text="Financial Dashboard" FontSize="28" FontAttributes="Bold" HorizontalOptions="Center"/>

                <Frame CornerRadius="10" Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label Text="Total Balance:" FontAttributes="Bold" HorizontalTextAlignment="Center" FontSize="24"/>
                        <Label x:Name="TotalBalanceLabel" Text="£9,361" FontSize="30" FontAttributes="Bold" HorizontalTextAlignment="Center" Margin="0,10,0,10"/>
                        <Label Text="see financial diagnostics >>" TextColor="#6f61ef" HorizontalTextAlignment="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnDiagnosticsLabelTapped"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </StackLayout>
                </Frame>

                <Frame CornerRadius="10" Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label Text="Financial Health Meter" FontAttributes="Bold" FontSize="22" HorizontalOptions="Center"/>
                        <Label Text="How well are you managing your finances this month?" HorizontalTextAlignment="Center" Margin="0,10,0,10"/>

                        <gauge:SfRadialGauge HeightRequest="200">
                            <gauge:SfRadialGauge.Axes>
                                <gauge:RadialAxis Minimum="0" Maximum="100"
                                                  StartAngle="180" EndAngle="0"
                                                  ShowTicks="True" ShowLabels="True"
                                                  TickOffset="0.05" LabelOffset="0.15"
                                                  MinorTicksPerInterval="3"
                                                  RadiusFactor="0.8">
                                    <gauge:RadialAxis.Ranges>
                                        <gauge:RadialRange StartValue="0" EndValue="33" Fill="Red" />
                                        <gauge:RadialRange StartValue="33" EndValue="67" Fill="Orange" />
                                        <gauge:RadialRange StartValue="67" EndValue="100" Fill="Green" />
                                    </gauge:RadialAxis.Ranges>

                                    <gauge:RadialAxis.Pointers>
                                        <gauge:NeedlePointer x:Name="HealthMeterNeedle" Value="0"
                                                             KnobRadius="0.1"
                                                             NeedleLength="0.8"
                                                             NeedleStartWidth="3"
                                                             NeedleEndWidth="3"
                                                             KnobStroke="DimGray" />
                                    </gauge:RadialAxis.Pointers>
                                </gauge:RadialAxis>
                            </gauge:SfRadialGauge.Axes>
                        </gauge:SfRadialGauge>

                        <Label x:Name="HealthMeterPercentageLabel" Text="Loading..." TextColor="Gray" FontAttributes="Bold" HorizontalOptions="Center"/>

                        <Label Text="see categorized spending >>>" HorizontalTextAlignment="Center" TextColor="#6f61ef">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCategorizedSpendingTapped"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </StackLayout>
                </Frame>

                <Frame CornerRadius="10" Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label Text="Budget Alerts" FontAttributes="Bold" FontSize="20" Margin="0,0,0,10"/>
                        <StackLayout x:Name="BudgetAlertsContainer">
                            <StackLayout Orientation="Horizontal" Spacing="10">
                                <Label Text="⚠" FontSize="18" FontAttributes="Bold" TextColor="DarkRed"/>
                                <Label Text="You have used all your grocery budget"/>
                            </StackLayout>
                            <StackLayout Orientation="Horizontal" Spacing="10">
                                <Label Text="⚠" FontSize="18" FontAttributes="Bold" TextColor="DarkOrange"/>
                                <Label Text="You're £3 away from your luxury budget"/>
                            </StackLayout>
                            <StackLayout Orientation="Horizontal" Spacing="10">
                                <Label Text="✓" FontSize="18" FontAttributes="Bold" TextColor="DarkGreen"/>
                                <Label Text="You're within your retail budget this month"/>
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </Frame>

                <Frame CornerRadius="10" Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label Text="Categorized Spending" FontAttributes="Bold" Margin="0,5,0,20" FontSize="22" HorizontalOptions="Center"/>

                        <StackLayout x:Name="CategorizedSpendingContainer">
                            <StackLayout Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                                <Label Text="Mortgage"/>
                                <Label Text="£1200 / £1500" HorizontalOptions="EndAndExpand"/>
                            </StackLayout>
                            <ProgressBar Margin="0,0,0,10" Progress="0.8" ProgressColor="#6f61ef"/>
                        </StackLayout>

                        <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand" Spacing="20">
                            <Button Margin="0,10,0,10" Text="+ Add New Category" TextColor="White" BackgroundColor="#6f61ef" BorderColor="Grey" BorderWidth="1" CornerRadius="20" FontAttributes="Bold" Clicked="OnAddCategoryClicked"/>
                        </StackLayout>
                    </StackLayout>
                </Frame>

                

                <Frame CornerRadius="10" Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label Text="Financial Goals:" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,0,0,20"/>
                        <ListView ItemsSource="{Binding Goals}" RowHeight="105" HasUnevenRows="False">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <ViewCell>
                                        <Frame CornerRadius="10" Padding="15" BackgroundColor="White" VerticalOptions="Center">
                                            <Grid RowDefinitions="Auto, Auto, Auto" ColumnDefinitions="Auto, *, Auto">
                                                <Label Grid.Column="1" Text="{Binding Name}" FontAttributes="Bold" TextColor="Black" FontSize="16" VerticalOptions="Center"/>

                                                <Label Grid.Row="1" Grid.Column="1" Text="{Binding Description}" TextColor="#666" FontSize="12"/>

                                                <VerticalStackLayout Grid.Column="2" Grid.RowSpan="2" HorizontalOptions="End" VerticalOptions="Center" Margin="0,0,10,0">
                                                    <Label Text="{Binding RemainingAmountFormatted}" FontAttributes="Bold" TextColor="Black" HorizontalOptions="End" FontSize="16"/>
                                                    <Label Text="{Binding FormattedTargetDate, StringFormat='Target: {0}'}" FontSize="12" HorizontalOptions="End" TextColor="#666"/>
                                                </VerticalStackLayout>

                                                <ProgressBar Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Progress="{Binding Progress}"
                                     ProgressColor="{StaticResource Primary}"
                                     BackgroundColor="#ddd" HeightRequest="5" Margin="0,5,0,0"/>

                                                <Button Grid.Column="2" Grid.Row="2"
                                Text="Delete"
                                FontSize="12"
                                TextColor="Red" BackgroundColor="Transparent"
                                BorderColor="Red" BorderWidth="1"
                                CornerRadius="5"
                                Padding="8,5"
                                VerticalOptions="Center"
                                HorizontalOptions="End"
                                Margin="0, 5, 0, 0"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type local:GoalViewModel}}, Path=DeleteGoalCommand}"
                                CommandParameter="{Binding GoalId}"/>
                                            </Grid>
                                        </Frame>
                                    </ViewCell>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                        <StackLayout x:Name="FinancialGoalsContainer">
                            <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand">
                                <Label Text="Vacation Fund" FontAttributes="Bold"/>
                                <Image Source="edit_icon.png" HorizontalOptions="End" WidthRequest="20" HeightRequest="20">
                                    <Image.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnEditGoalTapped"/>
                                    </Image.GestureRecognizers>
                                </Image>
                            </StackLayout>
                            <Label Text="Trip to Bali in December"/>
                            <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand">
                                <ProgressBar Progress="0.43" ProgressColor="#6f61ef" WidthRequest="200" VerticalOptions="Center"/>
                                <Label Text="3 months left" HorizontalOptions="EndAndExpand"/>
                            </StackLayout>
                            <StackLayout Orientation="Horizontal" Spacing="10">
                                <Label Text="43% complete" TextColor="#6f61ef"/>
                                <Label Text="£263 remaining" HorizontalOptions="EndAndExpand"/>
                            </StackLayout>
                        </StackLayout>

                        <StackLayout Orientation="Horizontal" Margin="0,15,0,0" Spacing="20">
                            <Button Text="+ Add New Goal" TextColor="White" BackgroundColor="#6f61ef" BorderColor="Grey" BorderWidth="1" CornerRadius="20" FontAttributes="Bold" Clicked="OnAddGoalClicked"/>
                            <Label Text="view all goals >>>" TextColor="#6f61ef" VerticalOptions="Center">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnViewAllGoalsTapped"/>
                                </Label.GestureRecognizers>
                            </Label>
                        </StackLayout>
                    </StackLayout>
                </Frame>


            </StackLayout>


        </ScrollView>
        <Grid Grid.Row="3" BackgroundColor="White" HeightRequest="60" ColumnDefinitions="*,*,*,*">
            <Image Grid.Column="0" Source="home_purple.png" HeightRequest="24" HorizontalOptions="Center" VerticalOptions="Center" x:Name="home">
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Tapped="home_Tapped"></TapGestureRecognizer>
                </Image.GestureRecognizers>
            </Image>
            <Image Grid.Column="1" Source="budget_grey.png" HeightRequest="24" HorizontalOptions="Center" VerticalOptions="Center" x:Name="budget">
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Tapped="budget_Tapped"/>
                </Image.GestureRecognizers>
            </Image>
            <Image Grid.Column="2" Source="investment_grey.png" HeightRequest="24" HorizontalOptions="Center" VerticalOptions="Center" x:Name="investment">
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Tapped="investment_Tapped"/>
                </Image.GestureRecognizers>
            </Image>
            <Image Grid.Column="3" Source="infohub_grey.png" HeightRequest="24" HorizontalOptions="Center" VerticalOptions="Center" x:Name="infohub">
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Tapped="infohub_Tapped"/>
                </Image.GestureRecognizers>
            </Image>
        </Grid>
    </Grid>
</ContentPage>